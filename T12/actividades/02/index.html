<!DOCTYPE html>
<html lang="es">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Renderizado de JSON con AJAX</title>
<script src="https://ajax.googleapis.com/ajax/libs/jquery/3.5.1/jquery.min.js"></script>
</head>
<body>
<h2>Renderizado de JSON con AJAX</h2>
<h3>Con promesas</h3>
<table id="tablaPromesas">
    <thead>
        <tr>
            <th>ID</th>
            <th>Nombre</th>
            <th>Costes</th>
            <th>Total</th>
        </tr>
    </thead>
    <tbody></tbody>
</table>
<h3>Con jQuery</h3>
<table id="tablajQuery">
    <thead>
        <tr>
            <th>ID</th>
            <th>Nombre</th>
            <th>Costes</th>
            <th>Total</th>
        </tr>
    </thead>
    <tbody></tbody>
</table>

<script>
// Función para renderizar usando promesas
function renderizarConPromesas() {
    return new Promise((resolve, reject) => {
        $.ajax({
            url: 'carteras.json',
            type: 'GET',
            dataType: 'json',
            success: function(data) {
                resolve(data);
            },
            error: function(xhr, status, error) {
                reject(error);
            }
        });
    });
}

// Función para renderizar usando async-await
async function renderizarConAsyncAwait() {
    try {
        const datos = await renderizarConPromesas();
        renderizarTabla(datos, '#tablaPromesas');
    } catch (error) {
        console.error('Error:', error);
    }
}

// Función para renderizar usando jQuery
function renderizarConjQuery() {
    $.getJSON('carteras.json', function(data) {
        renderizarTabla(data, '#tablajQuery');
    });
}

// Función para renderizar la tabla
function renderizarTabla(datos, tablaId) {
    const cuerpoTabla = $(tablaId + ' tbody');
    cuerpoTabla.empty();

    datos.forEach(item => {
        const totalCoste = calcularTotalCoste(item.costes);
        const fila = `<tr>
                        <td>${item.id}</td>
                        <td>${item.nombre}</td>
                        <td>${renderizarCostes(item.costes)}</td>
                        <td>${totalCoste}</td>
                    </tr>`;
        cuerpoTabla.append(fila);
    });
}

// Función para calcular el total de los costes por cartera
function calcularTotalCoste(costes) {
    let total = 0;
    for (const coste in costes) {
        total += costes[coste];
    }
    return total;
}

// Función para renderizar los costes
function renderizarCostes(costes) {
    let costesRenderizados = '';
    for (const coste in costes) {
        costesRenderizados += `${coste}: ${costes[coste]}<br>`;
    }
    return costesRenderizados;
}

// Llamar a las funciones de renderizado
renderizarConAsyncAwait();
renderizarConjQuery();
</script>

</body>
</html>
